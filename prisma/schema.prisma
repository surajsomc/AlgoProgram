generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model Topic {
  id          Int        @id @default(autoincrement())
  name        String
  slug        String     @unique
  description String
  icon        String     @default("ðŸ“¦")
  order       Int
  concepts    Concept[]
  problems    Problem[]
  progress    UserProgress[]
}

model Concept {
  id              Int    @id @default(autoincrement())
  topicId         Int
  title           String
  content         String
  timeComplexity  String @default("")
  spaceComplexity String @default("")
  whenToUse       String @default("")
  codeExample     String @default("")
  flashcardFront  String @default("")
  flashcardBack   String @default("")
  order           Int    @default(0)
  topic           Topic  @relation(fields: [topicId], references: [id], onDelete: Cascade)
  notes           Note[]
}

model Problem {
  id          Int              @id @default(autoincrement())
  topicId     Int
  title       String
  slug        String           @unique
  difficulty  String           @default("Easy")
  description String
  examples    String           @default("[]")
  hints       String           @default("[]")
  solution    String           @default("")
  explanation String           @default("")
  pattern     String           @default("")
  order       Int              @default(0)
  topic       Topic            @relation(fields: [topicId], references: [id], onDelete: Cascade)
  attempts    ProblemAttempt[]
  bookmarks   Bookmark[]
  notes       Note[]
}

model UserProgress {
  id          Int      @id @default(autoincrement())
  topicId     Int
  completed   Boolean  @default(false)
  lastStudied DateTime @default(now())
  topic       Topic    @relation(fields: [topicId], references: [id], onDelete: Cascade)

  @@unique([topicId])
}

model ProblemAttempt {
  id             Int       @id @default(autoincrement())
  problemId      Int
  status         String    @default("attempted")
  attemptCount   Int       @default(1)
  nextReviewDate DateTime?
  interval       Float     @default(0)
  easeFactor     Float     @default(2.5)
  repetitions    Int       @default(0)
  timeSpentSecs  Int       @default(0)
  lastAttemptAt  DateTime  @default(now())
  createdAt      DateTime  @default(now())
  problem        Problem   @relation(fields: [problemId], references: [id], onDelete: Cascade)

  @@unique([problemId])
}

model DailyActivity {
  id               Int    @id @default(autoincrement())
  date             String @unique
  problemsSolved   Int    @default(0)
  problemsAttempted Int   @default(0)
  quizzesTaken     Int    @default(0)
  minutesStudied   Int    @default(0)
}

model UserSettings {
  id             Int    @id @default(autoincrement())
  dailyGoal      Int    @default(3)
  currentStreak  Int    @default(0)
  longestStreak  Int    @default(0)
  lastActiveDate String @default("")
}

model StudyEvent {
  id         Int      @id @default(autoincrement())
  type       String
  entityId   Int
  entityName String
  metadata   String   @default("{}")
  createdAt  DateTime @default(now())
}

model Bookmark {
  id        Int      @id @default(autoincrement())
  problemId Int      @unique
  createdAt DateTime @default(now())
  problem   Problem  @relation(fields: [problemId], references: [id], onDelete: Cascade)
}

model Note {
  id        Int      @id @default(autoincrement())
  problemId Int?     @unique
  conceptId Int?     @unique
  content   String
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())
  problem   Problem? @relation(fields: [problemId], references: [id], onDelete: Cascade)
  concept   Concept? @relation(fields: [conceptId], references: [id], onDelete: Cascade)
}

model QuizAttempt {
  id                 Int      @id @default(autoincrement())
  score              Int
  total              Int
  percentage         Float
  patternPerformance String   @default("{}")
  createdAt          DateTime @default(now())
}
